<?xml version="1.0"?>
<ruleset name="Loadsys">
	<description>Loadsys coding standard</description>

	<exclude-pattern>\.git</exclude-pattern>
	<exclude-pattern>*/config/*.ini.php</exclude-pattern>
	<exclude-pattern>/*/tmp/</exclude-pattern>

	<!-- Include most CakePHP (and PSR-2/PSR-1, by extension) rules. -->
	<rule ref="CakePHP">
		<!-- Disable enforcing opening class brace on same line -->
		<exclude name="PSR2.Classes.ClassDeclaration.OpenBraceNewLine"/>
		<exclude name="Squiz.Functions.MultiLineFunctionDeclaration.BraceOnSameLine" />

		<!-- Disable enforcing leading underscores for protected/private methods. -->
		<exclude name="Squiz.NamingConventions.ValidFunctionName.PrivateNoUnderscore"/>
		<exclude name="PEAR.NamingConventions.ValidFunctionName.PrivateNoUnderscore"/>
		<!-- Disable enforcing no leading underscores for public methods (we have our own). -->
		<exclude name="CakePHP.NamingConventions.ValidFunctionName.PublicWithUnderscore"/>

		<!-- Disable enforcing spaces for indenting. -->
		<exclude name="Generic.WhiteSpace.DisallowTabIndent"/>

		<!-- Disable enforcing opening function brace on a new line. -->
		<exclude name="Squiz.Functions.MultiLineFunctionDeclaration.BraceOnSameLine"/>

		<!-- Disable Cake core's enforcement of no private methods. -->
		<exclude name="CakePHP.NamingConventions.ValidFunctionName.PrivateMethodInCore"/>

		<!-- Exclude PEAR style control structures like `if (...)\n{\n` -->
		<exclude name="PEAR.ControlStructures.ControlSignature"/>
	</rule>

	<!--
	Enforce "the opposite" of the disabled PSR-2/CakePHP rules above. In
	other words; it's not enough to DISable the enforcement of spaces for
	indenting, we must also ENable enforcement of tabs for indenting.
	-->
	<rule ref="Generic.WhiteSpace.DisallowSpaceIndent"/>
	<rule ref="Generic.Functions.OpeningFunctionBraceKernighanRitchie"/>
	<!-- Loadsys.NamingConventions.ValidClassBrackets.InvalidBracketPlacement -->

	<!--
	Make using underscores in private and protected variable names a
	warning (that can then be suppressed) for compatibility with Entity
	classes that require this.
	-->
	<rule ref="Loadsys.NamingConventions.ValidPrivateProtectedVariableName.PublicHasUnderscore">
		<type>warning</type>
	</rule>

	<rule ref="Loadsys.NamingConventions.ValidPrivateProtectedVariableName.ProtectedUnderscore">
		<type>warning</type>
	</rule>

	<rule ref="Loadsys.NamingConventions.ValidPrivateProtectedVariableName.PrivateWithUnderscore">
		<type>warning</type>
	</rule>

	<!--
	Make using underscores in private and protected class method names a
	warning (that can then be suppressed) for compatibility with Entity
	classes that require this.
	-->
	<rule ref="Loadsys.NamingConventions.ValidPrivateProtectedFunctionName.PublicWithUnderscore">
		<type>warning</type>
	</rule>

	<rule ref="Loadsys.NamingConventions.ValidPrivateProtectedFunctionName.ProtectedWithUnderscore">
		<type>warning</type>
	</rule>

	<rule ref="Loadsys.NamingConventions.ValidPrivateProtectedFunctionName.PrivateWithUnderscore">
		<type>warning</type>
	</rule>

	<!--
	Phinx migration files define classes, but can not be namespaced
	(otherwise Phinx can't construct them by guessing the class name from
	the filename.
	Ref: https://github.com/robmorgan/phinx/blob/695ce926c402e4c75ec76ec0a11e027824ff05ea/src/Phinx/Migration/Manager.php#L403
	So relax the namespacing rules on the config/Migrations folder.
	-->
	<rule ref="PSR1.Classes.ClassDeclaration.MissingNamespace">
		<exclude-pattern>*/config/Migrations/*</exclude-pattern>
	</rule>


	<!-- Ensure file starts with `<?php` -->
	<rule ref="Generic.PHP.CharacterBeforePHPOpeningTag"/>

	<!-- There MUST NOT be trailing whitespace at the end of non-blank lines.
	 Blank lines must not have whitespace at all. -->
	<rule ref="Squiz.WhiteSpace.SuperfluousWhitespace">
		<properties>
			<property name="ignoreBlankLines" value="false"/>
		</properties>
	</rule>


	<!--
	@TODO: These sniffs need to be reviewed to see if they duplicate
	coverage already provided. The ones that should be kept need
	tests written for them.
	-->
	<rule ref="Generic.Arrays.DisallowLongArraySyntax" />
	<rule ref="Generic.CodeAnalysis.ForLoopShouldBeWhileLoop"/>
	<rule ref="Generic.CodeAnalysis.ForLoopWithTestFunctionCall"/>
	<rule ref="Generic.CodeAnalysis.JumbledIncrementer"/>
	<rule ref="Generic.CodeAnalysis.UnconditionalIfStatement"/>
	<rule ref="Generic.CodeAnalysis.UnnecessaryFinalModifier"/>
	<rule ref="Generic.Commenting.Fixme"/>
	<rule ref="Generic.Commenting.Todo"/>
	<rule ref="Generic.Formatting.DisallowMultipleStatements"/>
	<rule ref="Generic.Formatting.NoSpaceAfterCast"/>
	<rule ref="Generic.Metrics.NestingLevel"/>
	<rule ref="Generic.NamingConventions.CamelCapsFunctionName"/>
	<rule ref="Generic.NamingConventions.ConstructorName"/>
	<rule ref="Generic.NamingConventions.UpperCaseConstantName"/>
	<rule ref="Generic.PHP.DeprecatedFunctions"/>
	<rule ref="Generic.PHP.ForbiddenFunctions"/>
	<rule ref="Generic.PHP.LowerCaseConstant"/>
	<rule ref="Generic.PHP.NoSilencedErrors"/>
	<rule ref="Generic.Strings.UnnecessaryStringConcat"/>
	<rule ref="MySource.PHP.EvalObjectFactory"/>
	<rule ref="PEAR.ControlStructures.ControlSignature"/>
	<rule ref="PEAR.ControlStructures.MultiLineCondition"/>
	<rule ref="PEAR.NamingConventions.ValidClassName"/>
	<rule ref="PEAR.NamingConventions.ValidFunctionName"/>
	<rule ref="Squiz.Arrays.ArrayBracketSpacing"/>
	<rule ref="Squiz.Classes.LowercaseClassKeywords"/>
	<rule ref="Squiz.Commenting.DocCommentAlignment"/>
	<rule ref="Squiz.Operators.ValidLogicalOperators"/>
	<rule ref="Squiz.PHP.DisallowMultipleAssignments"/>
	<rule ref="Squiz.PHP.DisallowObEndFlush"/>
	<rule ref="Squiz.PHP.DisallowSizeFunctionsInLoops"/>
	<rule ref="Squiz.PHP.Eval"/>
	<rule ref="Squiz.PHP.LowercasePHPFunctions"/>
	<rule ref="Squiz.PHP.NonExecutableCode"/>
	<rule ref="Squiz.Scope.MemberVarScope"/>
	<rule ref="Squiz.Scope.MethodScope"/>
	<rule ref="Squiz.Scope.StaticThisUsage"/>
	<rule ref="Squiz.WhiteSpace.CastSpacing"/>
	<rule ref="Squiz.WhiteSpace.ControlStructureSpacing"/>
	<rule ref="Squiz.WhiteSpace.FunctionOpeningBraceSpace"/>
	<rule ref="Squiz.WhiteSpace.LanguageConstructSpacing"/>
	<rule ref="Squiz.WhiteSpace.LogicalOperatorSpacing"/>
	<rule ref="Squiz.WhiteSpace.SemicolonSpacing"/>
	<rule ref="Squiz.WhiteSpace.SuperfluousWhitespace"/>

	<!-- All rules in ./Sniffs are included automatically -->
</ruleset>
